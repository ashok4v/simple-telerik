(function(b){var a=b.telerik;a.grid=function(e,f){this.element=e;this.groups=[];this.editing={};this.filterBy="";this.groupBy="";this.orderBy="";b.extend(this,f);this.sorted=b.grep(this.columns,function(g){return g.order});b(".t-pager .t-state-disabled",e).live("click",a.preventDefault);b(".t-pager .t-link:not(.t-state-disabled)",e).live("mouseenter",a.hover).live("mouseleave",a.leave);b(".t-pager input[type=text]",e).live("keydown",a.delegate(this,this.pagerKeyDown));b(".t-button",this.element).live("mouseenter",a.buttonHover).live("mouseleave",a.buttonLeave);if(this.sort){b(".t-header .t-link",e).live("mouseenter",a.hover).live("mouseleave",a.leave)}for(var d=0;d<this.plugins.length;d++){a[this.plugins[d]].initialize(this)}var c=this.$headerWrap=b(".t-grid-header-wrap",e);b(".t-grid-content",e).bind("scroll",function(){c.scrollLeft(this.scrollLeft)});this.$tbody=b(".t-grid-content table tbody",e);if(!this.$tbody.length){this.$tbody=b("table tbody",e)}if(this.selectable){b("tr:not(.t-grouping-row)",this.$tbody[0]).live("click",a.delegate(this,this.rowClick)).live("mouseenter",a.hover).live("mouseleave",a.leave)}b(".t-refresh",e).live("click",a.delegate(this,this.refreshClick));a.bind(this,{error:this.onError,dataBinding:this.onDataBinding,dataBound:this.onDataBound,rowSelected:this.onRowSelected,rowDataBound:this.onRowDataBound,load:this.onLoad});if(this.isAjax()){b(".t-pager .t-link:not(.t-state-disabled)",e).live("click",a.delegate(this,this.pagerClick));if(this.sort){b(".t-header > .t-link",e).live("click",a.delegate(this,this.headerClick))}}this.createColumnMappings();a.trigger(e,"load")};a.grid.prototype={rowClick:function(d,c){b(c).addClass("t-state-selected").siblings().removeClass("t-state-selected");if(this.onRowSelected){a.trigger(this.element,"rowSelected",{row:c})}},headerClick:function(d,c){d.preventDefault();this.toggleOrder(this.$columns().index(c.parentNode));this.sort(this.sortExpr())},refreshClick:function(d,c){d.preventDefault();if(b(c).is(".t-loading")){return}if(this.isAjax()){this.ajaxRequest(true)}else{location.reload()}},sort:function(c){this.orderBy=c;this.ajaxRequest()},columnFromMember:function(c){return b.grep(this.columns,function(d){return d.member==c})[0]},toggleOrder:function(e){e=typeof e=="number"?this.columns[e]:e;var c="asc";if(e.order=="asc"){c="desc"}else{if(e.order=="desc"){c=null}}e.order=c;var d=b.inArray(e,this.sorted);if(this.sortMode=="single"&&d<0){b.each(this.sorted,function(){this.order=null});this.sorted=[]}if(d<0&&c){this.sorted.push(e)}if(!c){this.sorted.splice(d,1)}},sortExpr:function(){return b.map(this.sorted,function(c){return c.member+"-"+c.order}).join("~")},pagerKeyDown:function(f,d){if(f.keyCode==13){var c=this.sanitizePage(b(d).val());if(c!=this.currentPage){this.pageTo(c)}else{b(d).val(c)}}},isAjax:function(){return this.ajax||this.ws||this.onDataBinding},url:function(c){return(this.ajax||this.ws)[c]},pagerClick:function(h,g){h.preventDefault();var c=this.currentPage;var i=b(g).find(".t-icon");if(i.hasClass("t-arrow-next")){c++}else{if(i.hasClass("t-arrow-last")){c=this.totalPages()}else{if(i.hasClass("t-arrow-prev")){c--}else{if(i.hasClass("t-arrow-first")){c=1}else{var f=b(g).text();if(f=="..."){var d=b(g).parent().children().index(g);if(d==0){c=parseInt(b(g).next().text(),10)-1}else{c=parseInt(b(g).prev().text(),10)+1}}else{c=parseInt(f,10)}}}}}this.pageTo(c)},pageTo:function(c){this.currentPage=c;this.ajaxRequest()},ajaxOptions:function(e){var d={type:"POST",dataType:"json",error:b.proxy(function(g,f){if(a.ajaxError(this.element,"error",g,f)){return}if(f=="parsererror"){alert("Error! The requested URL did not return JSON.")}},this),complete:b.proxy(this.hideBusy,this),success:b.proxy(function(f){f=f.d||f;this.total=f.total||f.Total||0;this.dataBind(f.data||f.Data)},this)};b.extend(d,e);var c=this.ws?d.data.state={}:d.data;c[this.queryString.page]=this.currentPage;c[this.queryString.size]=this.pageSize;c[this.queryString.orderBy]=this.orderBy||"";c[this.queryString.groupBy]=this.groupBy;c[this.queryString.filter]=(this.filterBy||"").replace(/\"/g,'\\"');if(this.ws){d.data=a.toJson(d.data);d.contentType="application/json; charset=utf-8"}return d},showBusy:function(){this.busyTimeout=setTimeout(b.proxy(function(){b(".t-status .t-icon",this.element).addClass("t-loading")},this),100)},hideBusy:function(){clearTimeout(this.busyTimeout);b(".t-status .t-icon",this.element).removeClass("t-loading")},ajaxRequest:function(){if(a.trigger(this.element,"dataBinding",{page:this.currentPage,sortedColumns:this.sorted,filteredColumns:b.grep(this.columns,function(c){return c.filters})})){return}if(!this.ajax&&!this.ws){return}this.showBusy();b.ajax(this.ajaxOptions({data:{},url:this.url("selectUrl")}))},valueFor:function(c){if(c.type=="Date"){return new Function("data","return data."+c.member+"? new Date(parseInt(data."+c.member+'.replace(/\\/Date\\((.*?)\\)\\//, "$1"))) : null;')}return new Function("data","return data."+c.member+";")},displayFor:function(c){if(!c.template){if(c.format||c.type=="Date"){return function(d){return a.formatString(c.format||"{0:G}",c.value(d))}}return c.value}return new Function("data","var p=[],print=function(){p.push.apply(p,arguments);};with(data){p.push('"+unescape(c.template).replace(/[\r\t\n]/g," ").replace(/'(?=[^#]*#>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<#=(.+?)#>/g,"',$1,'").split("<#").join("');").split("#>").join("p.push('")+"');}return p.join('');")},createColumnMappings:function(){for(var d=0,e=this.columns.length;d<e;d++){var c=this.columns[d];if(!c.member){continue}c.value=this.valueFor(c);c.display=this.displayFor(c);c.edit=c.type!="Date"?c.value:c.display}},bindData:function(h,f,k){Array.prototype.push.apply(this.data,h);var g=Math.min(this.pageSize,h.length);if(this.pageSize==0){g=h.length}for(var e=0;e<g;e++){if(e%2==1){f.cat('<tr class="t-alt">')}else{f.cat("<tr>")}f.rep('<td class="t-groupcell"></td>',k);for(var c=0,d=this.columns.length;c<d;c++){var j=this.columns[c];f.cat("<td").cat(j.attr).catIf(' class="t-last"',c==d-1).cat(">");var m=j.display;if(m){f.cat(m(h[e]))}this.appendCommandHtml(j.commands,f)}}},appendCommandHtml:function(d,c){if(d){var e=this.localization;b.each(d,function(){c.cat('<a href="#" class="t-grid-action t-button t-state-default t-grid-').cat(this.name).cat('" ').cat(this.attr).cat(">").cat(e[this.name]).cat("</a>")})}},normalizeColumns:function(){},bindTo:function(h){var c=new a.stringBuilder();if(h&&h.length){if("HasSubgroups" in h[0]){this.normalizeColumns();var f=this.groups.length+this.columns.length;for(var d=0,e=h.length;d<e;d++){this.bindGroup(h[d],f,c,0)}}else{this.normalizeColumns();this.bindData(h,c)}}this.$tbody.html(c.string());if(this.onRowDataBound){var g=jQuery.grep(this.$tbody[0].rows,function(i){return !b(i).hasClass("t-grouping-row")});for(var d=0,e=this.data.length;d<e;d++){a.trigger(this.element,"rowDataBound",{row:g[d],dataItem:this.data[d]})}}},updatePager:function(){var d=this.totalPages(this.total);var c=this.currentPage;var e=b(".t-pager",this.element);e.find(".t-arrow-next").parent().add(e.find(".t-arrow-last").parent()).toggleClass("t-state-disabled",c>=d).removeClass("t-state-hover");e.find(".t-arrow-prev").parent().add(e.find(".t-arrow-first").parent()).toggleClass("t-state-disabled",c==1).removeClass("t-state-hover");var f=this.localization;e.find(".t-page-i-of-n").each(function(){this.innerHTML=new a.stringBuilder().cat(f.page).cat('<input type="text" value="').cat(c).cat('" /> ').cat(a.formatString(f.pageOf,d)).string()});e.find(".t-numeric").each(b.proxy(function(h,g){this.numericPager(g,c,d)},this));b(".t-status-text",this.element).text(a.formatString(f.displayingItems,this.firstItemInPage(),this.lastItemInPage(),this.total))},numericPager:function(j,h,k){var i=10;var c=1;if(h>i){var f=(h%i);c=(f==0)?(h-i)+1:(h-f)+1}var g=(c+i)-1;g=Math.min(g,k);var d=new a.stringBuilder();if(c>1){d.cat('<a class="t-link">...</a>')}for(var e=c;e<=g;e++){if(e==h){d.cat('<span class="t-state-active">').cat(e).cat("</span>")}else{d.cat('<a class="t-link">').cat(e).cat("</a>")}}if(g<k){d.cat('<a class="t-link">...</a>')}j.innerHTML=d.string()},$columns:function(){return b("th.t-header:not(.t-groupcell)",this.element)},updateSorting:function(){this.sorted=[];b.each(this.orderBy.split("~"),b.proxy(function(e,c){var f=c.split("-");var d=this.columnFromMember(f[0]);if(d){d.order=f[1];this.sorted.push(d)}},this));this.$columns().each(b.proxy(function(f,g){var d=this.columns[f].order;var e=b(g).children(".t-link");var c=e.children(".t-icon");if(!d){c.hide()}else{if(c.length==0){c=b('<span class="t-icon"/>').appendTo(e)}c.toggleClass("t-arrow-up",d=="asc").toggleClass("t-arrow-down",d=="desc").show()}},this))},sanitizePage:function(c){var d=parseInt(c,10);if(isNaN(d)||d<1){return 1}return Math.min(d,this.totalPages())},totalPages:function(){return Math.ceil(this.total/this.pageSize)},firstItemInPage:function(){return this.total>0?(this.currentPage-1)*this.pageSize+1:0},lastItemInPage:function(){return Math.min(this.currentPage*this.pageSize,this.total)},dataBind:function(c){this.data=[];this.bindTo(c);this.updatePager();this.updateSorting();a.trigger(this.element,"dataBound")},rebind:function(c){this.sorted=[];this.filterBy="";this.currentPage=1;b.each(this.columns,function(){this.order=null;this.filters=[]});b(".t-filter-options",this.element).find('input[type="text"], select').val("").removeClass("t-state-error");for(var e in c){var f=new RegExp(a.formatString("({0})=([^&]*)",e),"g");if(f.test(this.ajax.selectUrl)){this.ajax.selectUrl=this.ajax.selectUrl.replace(f,"$1="+c[e])}else{var d=new a.stringBuilder();d.cat(this.ajax.selectUrl);if(this.ajax.selectUrl.indexOf("?")<0){d.cat("?")}else{d.cat("&")}this.ajax.selectUrl=d.cat(e).cat("=").cat(c[e]).string()}}this.ajaxRequest()}};b.fn.tGrid=function(c){c=b.extend({},b.fn.tGrid.defaults,c);return this.each(function(){c=b.meta?b.extend({},c,b(this).data()):c;if(!b(this).data("tGrid")){var d=new a.grid(this,c);b(this).data("tGrid",d);if(d.$tbody.find("tr.t-no-data").length){d.ajaxRequest()}}})};b.fn.tGrid.defaults={columns:[],plugins:[],currentPage:1,pageSize:10,localization:{addNew:"Add new record","delete":"Delete",cancel:"Cancel",insert:"Insert",update:"Update",select:"Select",pageOf:"of {0}",displayingItems:"Displaying items {0} - {1} of {2}",edit:"Edit",page:"Page ",filter:"Filter",filterClear:"Clear Filter",filterShowRows:"Show rows with value that",filterAnd:"And",filterStringEq:"Is equal to",filterStringNe:"Is not equal to",filterStringStartsWith:"Starts with",filterStringSubstringOf:"Contains",filterStringEndsWith:"Ends with",filterNumberEq:"Is equal to",filterNumberNe:"Is not equal to",filterNumberLt:"Is less than",filterNumberLe:"Is less than or equal to",filterNumberGt:"Is greater than",filterNumberGe:"Is greater than or equal to",filterDateEq:"Is equal to",filterDateNe:"Is not equal to",filterDateLt:"Is before",filterDateLe:"Is before or equal to",filterDateGt:"Is after",filterDateGe:"Is after or equal to",filterEnumEq:"Is equal to",filterEnumNe:"Is not equal to",filterSelectValue:"-Select value-",groupHint:"Drag a column header and drop it here to group by that column",deleteConfirmation:"Are you sure you want to delete this record?"},queryString:{page:"page",size:"size",orderBy:"orderBy",groupBy:"groupBy",filter:"filter"}}})(jQuery);